<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

      <title>Chord Transcription</title>
    
          <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
          <link rel="stylesheet" href="../_static/css/waveform-list.css" type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="../_static/theme-vendors.js"></script> -->
      <script src="../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="next" title="Vocal Transcription" href="../vocal/api.html" />
  <link rel="prev" title="Drum Transcription" href="../drum/api.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../index.html" class="home-link">
    
      <span class="site-name">omnizart</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../index.html#sound-samples"
         class="nav-link ">
         Contents
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#sound-samples"
         class="nav-link ">
         Command Line Interface
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#sound-samples"
         class="nav-link  router-link-active">
         API Reference
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../index.html#sound-samples"
         class="nav-link ">
         Contents
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#sound-samples"
         class="nav-link ">
         Command Line Interface
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#sound-samples"
         class="nav-link  router-link-active">
         API Reference
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#sound-samples">Contents</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../quick-start.html" class="reference internal ">Quick Start</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../tutorial.html" class="reference internal ">Tutorial</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../demo.html" class="reference internal ">Demonstration</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#sound-samples">Command Line Interface</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../music/cli.html" class="reference internal ">omnizart music</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../drum/cli.html" class="reference internal ">omnizart drum</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cli.html" class="reference internal ">omnizart chord</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../vocal/cli.html" class="reference internal ">omnizart vocal</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../vocal-contour/cli.html" class="reference internal ">omnizart vocal-contour</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../beat/cli.html" class="reference internal ">omnizart beat</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../patch-cnn/cli.html" class="reference internal ">omnizart patch-cnn</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#sound-samples">API Reference</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="../music/api.html" class="reference internal ">Music Transcription</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../drum/api.html" class="reference internal ">Drum Transcription</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Chord Transcription</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#feature-storage-format" class="reference internal">Feature Storage Format</a></li>
                
                  <li class="toctree-l2"><a href="#app" class="reference internal">App</a></li>
                
                  <li class="toctree-l2"><a href="#module-omnizart.chord.features" class="reference internal">Feature</a></li>
                
                  <li class="toctree-l2"><a href="#dataset" class="reference internal">Dataset</a></li>
                
                  <li class="toctree-l2"><a href="#module-omnizart.chord.inference" class="reference internal">Inference</a></li>
                
                  <li class="toctree-l2"><a href="#settings" class="reference internal">Settings</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../vocal/api.html" class="reference internal ">Vocal Transcription</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../vocal-contour/api.html" class="reference internal ">Vocal-Contour Transcription</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../patch-cnn/api.html" class="reference internal ">Patch-CNN Transcription</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../beat/api.html" class="reference internal ">Beat Transcription</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../feature.html" class="reference internal ">Feature</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../models.html" class="reference internal ">Models</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../training.html" class="reference internal ">Training</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../base.html" class="reference internal ">Base Classes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../constants.html" class="reference internal ">Constants</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../utils.html" class="reference internal ">Utilities</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
    <li>Chord Transcription</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="../drum/api.html"
       title="previous chapter">← Drum Transcription</a>
  </li>
  <li class="next">
    <a href="../vocal/api.html"
       title="next chapter">Vocal Transcription →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="module-omnizart.chord">
<span id="chord-transcription"></span><h1>Chord Transcription<a class="headerlink" href="#module-omnizart.chord" title="Permalink to this headline">¶</a></h1>
<p>Chord transcription for both MIDI and audio domain.</p>
<p>Re-implementation of the repository
<a class="reference external" href="https://github.com/Tsung-Ping/Harmony-Transformer">Tsung-Ping/Harmony-Transformer</a>.</p>
<section id="feature-storage-format">
<h2>Feature Storage Format<a class="headerlink" href="#feature-storage-format" title="Permalink to this headline">¶</a></h2>
<p>Processed feature will be stored in <code class="docutils literal notranslate"><span class="pre">.hdf</span></code> file format, one file per piece.</p>
<p>Columns in the file are:</p>
<ul class="simple">
<li><p><strong>chroma</strong>: the input feature for audio domain data.</p></li>
<li><p><strong>chord</strong>: the first type of ground-truth label.</p></li>
<li><p><strong>chord_change</strong>: the second type of ground-truth label.</p></li>
<li><p><strong>tc</strong></p></li>
<li><p><strong>sequence_len</strong></p></li>
<li><p><strong>num_sequence</strong></p></li>
</ul>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<p>The related publications and techinical details can be found in <a class="reference internal" href="#r1980e01904df-1" id="id1">[1]</a> and <a class="reference internal" href="#r1980e01904df-2" id="id2">[2]</a></p>
<dl class="citation">
<dt class="label" id="r1980e01904df-1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Tsung-Ping Chen and Li Su, “Harmony Transformer: Incorporating Chord
Segmentation Into Harmony Recognition,” International Society of
Music Information Retrieval Conference (ISMIR), 2019.</p>
</dd>
<dt class="label" id="r1980e01904df-2"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Tsung-Ping Chen and Li Su, “Functional Harmony Recognition with
Multi-task Recurrent Neural Networks,” International Society of Music Information
Retrieval Conference (ISMIR), September 2018</p>
</dd>
</dl>
</section>
</section>
<section id="app">
<h2>App<a class="headerlink" href="#app" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="omnizart.chord.app.ChordTranscription">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">omnizart.chord.app.</span></span><span class="sig-name descname"><span class="pre">ChordTranscription</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conf_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.app.ChordTranscription" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="../base.html#omnizart.base.BaseTranscription" title="omnizart.base.BaseTranscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">omnizart.base.BaseTranscription</span></code></a></p>
<p>Application class for chord transcription.</p>
<p class="rubric">Methods</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#omnizart.chord.app.ChordTranscription.generate_feature" title="omnizart.chord.app.ChordTranscription.generate_feature"><code class="xref py py-obj docutils literal notranslate"><span class="pre">generate_feature</span></code></a>(dataset_path[, ...])</p></td>
<td><p>Extract feature of McGill BillBoard dataset.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#omnizart.chord.app.ChordTranscription.get_model" title="omnizart.chord.app.ChordTranscription.get_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_model</span></code></a>(settings)</p></td>
<td><p>Get the chord model.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#omnizart.chord.app.ChordTranscription.train" title="omnizart.chord.app.ChordTranscription.train"><code class="xref py py-obj docutils literal notranslate"><span class="pre">train</span></code></a>(feature_folder[, model_name, ...])</p></td>
<td><p>Model training.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#omnizart.chord.app.ChordTranscription.transcribe" title="omnizart.chord.app.ChordTranscription.transcribe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">transcribe</span></code></a>(input_audio[, model_path, output])</p></td>
<td><p>Transcribe chords in the audio.</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt class="sig sig-object py" id="omnizart.chord.app.ChordTranscription.generate_feature">
<span class="sig-name descname"><span class="pre">generate_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chord_settings</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.app.ChordTranscription.generate_feature" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract feature of McGill BillBoard dataset.</p>
<p>There are three main features that will be used in the training:</p>
<ul class="simple">
<li><p>chroma: input feature of the NN model</p></li>
<li><p>chord: the first type of the ground-truth</p></li>
<li><p>chord_change: the second type of the ground-truth</p></li>
</ul>
<p>The last two feature will be both used for computing the training loss.
During the feature extraction, the feature data is stored as a numpy array
with named field, makes it works like a dict type.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="omnizart.chord.app.ChordTranscription.get_model">
<span class="sig-name descname"><span class="pre">get_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">settings</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.app.ChordTranscription.get_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the chord model.</p>
<p>More comprehensive reasons to having this method, please refer to
<code class="docutils literal notranslate"><span class="pre">omnizart.base.BaseTranscription.get_model</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="omnizart.chord.app.ChordTranscription.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_folder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_model_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chord_settings</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.app.ChordTranscription.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Model training.</p>
<p>Train a new music model or continue to train on a pre-trained model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>feature_folder: Path</strong></dt><dd><p>Path to the generated feature.</p>
</dd>
<dt><strong>model_name: str</strong></dt><dd><p>The name of the trained model. If not given, will default to the
current timestamp.</p>
</dd>
<dt><strong>input_model_path: Path</strong></dt><dd><p>Specify the path to the pre-trained model if you want to continue
to fine-tune on the model.</p>
</dd>
<dt><strong>chord_settings: ChordSettings</strong></dt><dd><p>The configuration instance that holds all relative settings for
the life-cycle of building a model.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="omnizart.chord.app.ChordTranscription.transcribe">
<span class="sig-name descname"><span class="pre">transcribe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_audio</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.app.ChordTranscription.transcribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Transcribe chords in the audio.</p>
<p>This function transcribes chord progression in the audio and will outputs MIDI
and CSV files. The MIDI file is provided for quick validation by directly listen
to the chords. The complete transcription results are listed in the CSV file,
which contains the chord’s name and the start and end time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>input_audio: Path</strong></dt><dd><p>Path to the raw audio file (.wav).</p>
</dd>
<dt><strong>model_path: Path</strong></dt><dd><p>Path to the trained model or the supported transcription mode.</p>
</dd>
<dt><strong>output: Path (optional)</strong></dt><dd><p>Path for writing out the transcribed MIDI file. Default to the current path.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>midi: pretty_midi.PrettyMIDI</dt><dd><p>Transcribed chord progression with default chord-to-notes mappings.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">omnizart.cli.chord.transcribe</span></code></dt><dd><p>CLI entry point of this function.</p>
</dd>
<dt><a class="reference internal" href="#module-omnizart.chord.inference" title="omnizart.chord.inference"><code class="xref py py-obj docutils literal notranslate"><span class="pre">omnizart.chord.inference</span></code></a></dt><dd><p>Records the default chord-to-notes mappings.</p>
</dd>
</dl>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="module-omnizart.chord.features">
<span id="feature"></span><h2>Feature<a class="headerlink" href="#module-omnizart.chord.features" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.augment_feature">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">augment_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.augment_feature" title="Permalink to this definition">¶</a></dt>
<dd><p>Feature augmentation</p>
<p>Variying pitches with 12 different shifts.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.compute_tonal_centroids">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">compute_tonal_centroids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chromagram</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filtering</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.compute_tonal_centroids" title="Permalink to this definition">¶</a></dt>
<dd><p>chromagram with shape [time, 12]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.extract_feature_label">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">extract_feature_label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lab_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">21</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_hop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.extract_feature_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic feature extraction block.</p>
<p>Including multiple steps for processing the feature.
Steps include:</p>
<ul class="simple">
<li><p>Feature augmentation</p></li>
<li><p>Feature segmentation</p></li>
<li><p>Feature reshaping</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>feat_path: Path</strong></dt><dd><p>Path to the raw feature folder.</p>
</dd>
<dt><strong>lab_path: Path</strong></dt><dd><p>Path to the corresponding label folder.</p>
</dd>
<dt><strong>segment_width: int</strong></dt><dd><p>Width of each frame after segementation.</p>
</dd>
<dt><strong>segment_hop: int</strong></dt><dd><p>Hop size for processing each segment.</p>
</dd>
<dt><strong>num_steps: int</strong></dt><dd><p>Number of steps while reshaping the feature.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>feature:</dt><dd><p>Processed feature</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.load_feature">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">load_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feat_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.load_feature" title="Permalink to this definition">¶</a></dt>
<dd><p>Load and parse the feature into the desired format.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.load_label">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">load_label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lab_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.load_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Load and parse the label into the desired format for later process.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.reshape_feature">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">reshape_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.reshape_feature" title="Permalink to this definition">¶</a></dt>
<dd><p>Reshape the feature into the final output.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.segment_feature">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">segment_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">21</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_hop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.segment_feature" title="Permalink to this definition">¶</a></dt>
<dd><p>Partition feature into segments.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.shift_chord">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">shift_chord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chord</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.shift_chord" title="Permalink to this definition">¶</a></dt>
<dd><p>Shift chord</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.features.shift_chromagram">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.features.</span></span><span class="sig-name descname"><span class="pre">shift_chromagram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chromagram</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.features.shift_chromagram" title="Permalink to this definition">¶</a></dt>
<dd><p>Shift chord’s chromagram.</p>
</dd></dl>

</section>
<section id="dataset">
<h2>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="omnizart.chord.app.McGillDatasetLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">omnizart.chord.app.</span></span><span class="sig-name descname"><span class="pre">McGillDatasetLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slice_hop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.app.McGillDatasetLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="../base.html#omnizart.base.BaseDatasetLoader" title="omnizart.base.BaseDatasetLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">omnizart.base.BaseDatasetLoader</span></code></a></p>
<p>McGill BillBoard dataset loader.</p>
<p>The feature column name stored in the .hdf files is slightly different from
others, which the name is <code class="docutils literal notranslate"><span class="pre">chroma</span></code>, not <code class="docutils literal notranslate"><span class="pre">feature</span></code>.
Also the returned label should be a tuple of two different ground-truth labels
to fit the training scenario.</p>
<dl class="field-list simple">
<dt class="field-odd">Yields</dt>
<dd class="field-odd"><dl class="simple">
<dt>feature:</dt><dd><p>Input feature for training the model.</p>
</dd>
<dt>label: tuple</dt><dd><p>gt_chord -&gt; Ground-truth chord label.
gt_chord_change -&gt; Ground-truth chord change label.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-omnizart.chord.inference">
<span id="inference"></span><h2>Inference<a class="headerlink" href="#module-omnizart.chord.inference" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.inference.inference">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.inference.</span></span><span class="sig-name descname"><span class="pre">inference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chord_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_unit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_dura</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.inference.inference" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="omnizart.chord.inference.write_csv">
<span class="sig-prename descclassname"><span class="pre">omnizart.chord.inference.</span></span><span class="sig-name descname"><span class="pre">write_csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./chord.csv'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.chord.inference.write_csv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h2>
<p>Below are the default settings for building the chord model. It will be loaded
by the class <code class="xref py py-class docutils literal notranslate"><span class="pre">omnizart.setting_loaders.ChordSettings</span></code>. The name of the
attributes will be converted to snake-case (e.g. HopSize -&gt; hop_size). There
is also a path transformation process when applying the settings into the
<code class="docutils literal notranslate"><span class="pre">ChordSettings</span></code> instance. For example, if you want to access the attribute
<code class="docutils literal notranslate"><span class="pre">BatchSize</span></code> defined in the yaml path <em>General/Training/Settings/BatchSize</em>,
the coressponding attribute will be <em>ChordSettings.training.batch_size</em>.
The level of <em>/Settings</em> is removed among all fields.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">General</span><span class="p">:</span>
    <span class="nt">TranscriptionMode</span><span class="p">:</span>
        <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Mode of transcription by executing the `omnizart chord transcribe` command.</span>
        <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
        <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChordV1</span>
    <span class="nt">CheckpointPath</span><span class="p">:</span>
        <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Path to the pre-trained models.</span>
        <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Map</span>
        <span class="nt">SubType</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">String</span><span class="p p-Indicator">,</span> <span class="nv">String</span><span class="p p-Indicator">]</span>
        <span class="nt">Value</span><span class="p">:</span>
            <span class="nt">ChordV1</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">checkpoints/chord/chord_v1</span>
    <span class="nt">Feature</span><span class="p">:</span>
        <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Default settings of feature extraction for drum transcription.</span>
        <span class="nt">Settings</span><span class="p">:</span>
            <span class="nt">SegmentWidth</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Width of segments. Each frame last for 0.046 seconds, and thus each segment would last for around 0.5 seconds.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">21</span>
            <span class="nt">SegmentHop</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Hop size of the segment.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
            <span class="nt">NumSteps</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Number of total steps. Default setting would have around 23 seconds.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="nt">Dataset</span><span class="p">:</span>
        <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Settings of datasets.</span>
        <span class="nt">Settings</span><span class="p">:</span>
            <span class="nt">SavePath</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Path for storing the downloaded datasets.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./</span>
            <span class="nt">FeatureSavePath</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Path for storing the extracted feature. Default to the path under the dataset folder.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">+</span>
    <span class="nt">Model</span><span class="p">:</span>
        <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Default settings of training / testing the model.</span>
        <span class="nt">Settings</span><span class="p">:</span>
            <span class="nt">SavePrefix</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Prefix of the trained model&#39;s name to be saved.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chord</span>
            <span class="nt">SavePath</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Path to save the trained model.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">String</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./checkpoints/chord</span>
            <span class="nt">NumEncAttnBlocks</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Number of attention blocks for encoder.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
            <span class="nt">NumDecAttnBlocks</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Number of attention blocks for decoder.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
            <span class="nt">FreqSize</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Available size on the frequency axis to be seen.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">24</span>
            <span class="nt">EncInputEmbSize</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Embedding size of the encoder&#39;s input.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">512</span>
            <span class="nt">DecInputEmbSize</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Embedding size of the decoder&#39;s input.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">512</span>
            <span class="nt">DropoutRate</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Dropout rate of all dropout layers.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Float</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.6</span>
            <span class="nt">AnnealingRate</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">To be added...</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Float</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.1</span>
    <span class="nt">Inference</span><span class="p">:</span>
        <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Default settings when infering notes.</span>
        <span class="nt">Settings</span><span class="p">:</span>
            <span class="nt">MinDura</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Minimum duration (in seconds) for each chord. If shorter than expected, will append the duration to the previous chord.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Float</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
    <span class="nt">Training</span><span class="p">:</span>
        <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Hyper parameters for training</span>
        <span class="nt">Settings</span><span class="p">:</span>
            <span class="nt">Epoch</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Maximum number of epochs for training.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
            <span class="nt">Steps</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Number of training steps for each epoch.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000</span>
            <span class="nt">ValSteps</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Number of validation steps after each training epoch.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">500</span>
            <span class="nt">BatchSize</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Batch size of each training step.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>
            <span class="nt">ValBatchSize</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Batch size of each validation step.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>
            <span class="nt">EarlyStop</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Terminate the training if the validation performance doesn&#39;t imrove after n epochs.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Integer</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
            <span class="nt">InitLearningRate</span><span class="p">:</span>
                <span class="nt">Descriptoin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Initial learning rate.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Float</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0001</span>
            <span class="nt">LearningRateDecay</span><span class="p">:</span>
                <span class="nt">Description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Decaying rate of learning rate per epoch.</span>
                <span class="nt">Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Float</span>
                <span class="nt">Value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.96</span>
</pre></div>
</div>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="../drum/api.html"
       title="previous chapter">← Drum Transcription</a>
  </li>
  <li class="next">
    <a href="../vocal/api.html"
       title="next chapter">Vocal Transcription →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2020, MCTLab.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.1 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>