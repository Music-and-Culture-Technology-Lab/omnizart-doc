<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>Utilities</title>
    
      <link rel="stylesheet" href="_static/pygments.css">
      <link rel="stylesheet" href="_static/theme.css">
      <link rel="stylesheet" href="_static/sphinx_press_theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

      
      <script src="_static/theme-vendors.js"></script>
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="prev" title="Constants" href="constants.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <span class="site-name">omnizart</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="index.html#demo"
         class="nav-link ">
         Contents
      </a>
    </div>
  
    <div class="nav-item">
      <a href="index.html#demo"
         class="nav-link  router-link-active">
         API Reference
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="index.html#demo"
         class="nav-link ">
         Contents
      </a>
    </div>
  
    <div class="nav-item">
      <a href="index.html#demo"
         class="nav-link  router-link-active">
         API Reference
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#demo">Contents</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="quick-start.html" class="reference internal ">Quick Start</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="tutorial.html" class="reference internal ">Tutorial</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="music/cli.html" class="reference internal ">omnizart music</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="drum/cli.html" class="reference internal ">omnizart drum</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="chord/cli.html" class="reference internal ">omnizart chord</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#demo">API Reference</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="music/api.html" class="reference internal ">Music Transcription</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="drum/api.html" class="reference internal ">Drum Transcription</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="chord/api.html" class="reference internal ">Chord Transcription</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="feature.html" class="reference internal ">Feature</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="models.html" class="reference internal ">Models</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="training.html" class="reference internal ">Training</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="base.html" class="reference internal ">Base Classes</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="constants.html" class="reference internal ">Constants</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">Utilities</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#module-omnizart.remote" class="reference internal">Remote</a></li>
                
                  <li class="toctree-l2"><a href="#module-omnizart.utils" class="reference internal">Utility Functions</a></li>
                
              </ul>
            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li>Utilities</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="constants.html"
       title="previous chapter">← Constants</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <div class="section" id="utilities">
<h1>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h1>
<p>Some common utility functionalities.</p>
<div class="section" id="module-omnizart.remote">
<span id="remote"></span><h2>Remote<a class="headerlink" href="#module-omnizart.remote" title="Permalink to this headline">¶</a></h2>
<p>Functions related to networking.</p>
<p>Containing functions to download files from the internet. Supports
download <em>zipped</em> files from Google Drive.</p>
<dl class="py data">
<dt id="omnizart.remote.SIZE_MAPPING">
<code class="sig-prename descclassname">omnizart.remote.</code><code class="sig-name descname">SIZE_MAPPING</code><em class="property"> = [(1, 'B'), (1024, 'KB'), (1048576, 'MB'), (1073741824, 'GB'), (1099511627776, 'TB')]</em><a class="headerlink" href="#omnizart.remote.SIZE_MAPPING" title="Permalink to this definition">¶</a></dt>
<dd><p>Mapping bytes to human-readable size unit.</p>
</dd></dl>

<dl class="py function">
<dt id="omnizart.remote.download">
<code class="sig-prename descclassname">omnizart.remote.</code><code class="sig-name descname">download</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="n">file_length</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">save_path</span><span class="o">=</span><span class="default_value">'./'</span></em>, <em class="sig-param"><span class="n">save_name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">cookie_file</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">unzip</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.remote.download" title="Permalink to this definition">¶</a></dt>
<dd><p>Download file from the internet.</p>
<p>Download file from the remote URL, with progress visualization and dynamic downloading
rate adjustment. Uses pure python built-in packages, no additional package requirement.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>url: URL</strong></dt><dd><p>The file download url.</p>
</dd>
<dt><strong>file_length: float</strong></dt><dd><p>In bytes. If the length can’t be retrieved from the response header, but can be
obtained by other approaches, you can explicitly specify the length for progress
visualization.</p>
</dd>
<dt><strong>save_path: Path</strong></dt><dd><p>The path to store the donwloaded file.</p>
</dd>
<dt><strong>save_name: str</strong></dt><dd><p>Explicitly specify the file name to be stored. If not given, default to parse the
name from the given url.</p>
</dd>
<dt><strong>cookie_file: Path</strong></dt><dd><p>Path to the cookie file. Suitable for stateful download (e.g. Google Drive).</p>
</dd>
<dt><strong>unzip: bool</strong></dt><dd><p>Whether to unzip (decompress) the downloaded file (assumed zipped). Will not delete
the original downloaded file.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>path: Path</dt><dd><p>The absolute path to the downloaded/extracted folder/file.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="omnizart.remote.download_large_file_from_google_drive">
<code class="sig-prename descclassname">omnizart.remote.</code><code class="sig-name descname">download_large_file_from_google_drive</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="n">file_length</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">save_path</span><span class="o">=</span><span class="default_value">'./'</span></em>, <em class="sig-param"><span class="n">save_name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">unzip</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.remote.download_large_file_from_google_drive" title="Permalink to this definition">¶</a></dt>
<dd><p>Google Drive file downloader.</p>
<p>Download function dedicated for Google Drive files. Mainly to deal with download
large files and the confirmation page.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>url: URL</strong></dt><dd><p>Could be a full google drive download url or the file ID.</p>
</dd>
<dt><strong>file_length: float</strong></dt><dd><p>In bytes. If the length can’t be retrieved from the response header, but can be
obtained by other approaches, you can explicitly specify the length for progress
visualization.</p>
</dd>
<dt><strong>save_path: Path</strong></dt><dd><p>Path to store the downloaded file.</p>
</dd>
<dt><strong>save_name: str</strong></dt><dd><p>Explicitly specify the file name to be stored. If not given, default to parse the
name from the given url.</p>
</dd>
<dt><strong>unzip: bool</strong></dt><dd><p>Whether to unzip (decompress) the downloaded file (assumed zipped). Will not delete
the original downloaded file.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>path: Path</dt><dd><p>The absolute path to the downloaded/extracted folder/file.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="omnizart.remote.format_byte">
<code class="sig-prename descclassname">omnizart.remote.</code><code class="sig-name descname">format_byte</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">size</span></em>, <em class="sig-param"><span class="n">digit</span><span class="o">=</span><span class="default_value">2</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.remote.format_byte" title="Permalink to this definition">¶</a></dt>
<dd><p>Format the given byte size into human-readable string.</p>
</dd></dl>

</div>
<div class="section" id="module-omnizart.utils">
<span id="utility-functions"></span><h2>Utility Functions<a class="headerlink" href="#module-omnizart.utils" title="Permalink to this headline">¶</a></h2>
<p>Various utility functions for this project.</p>
<dl class="py class">
<dt id="omnizart.utils.LazyLoader">
<em class="property">class </em><code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">LazyLoader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">local_name</span></em>, <em class="sig-param"><span class="n">parent_module_globals</span></em>, <em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">warning</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.LazyLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Lazily import a module, mainly to avoid pulling in large dependencies.</p>
<p>Original implementations are from tensorflow <a class="reference internal" href="#r4293d5747efb-1" id="id1">[1]</a>.</p>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="r4293d5747efb-1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/util/lazy_loader.py">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/util/lazy_loader.py</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="omnizart.utils.camel_to_snake">
<code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">camel_to_snake</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">string</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.camel_to_snake" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a camel case to snake case</p>
</dd></dl>

<dl class="py function">
<dt id="omnizart.utils.ensure_path_exists">
<code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">ensure_path_exists</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.ensure_path_exists" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="omnizart.utils.get_logger">
<code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">get_logger</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">level</span><span class="o">=</span><span class="default_value">'warn'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.get_logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the logger for printing informations.</p>
<p>Used for layout the information of various stages while executing the program.
Set the environment variable <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL</span></code> to change the default level.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>name: str</strong></dt><dd><p>Name of the logger.</p>
</dd>
<dt><strong>level: {‘debug’, ‘info’, ‘warn’, ‘warning’, ‘error’, ‘critical’}</strong></dt><dd><p>Level of the logger. The level ‘warn’ and ‘warning’ are different. The former
is the default level and the actual level is set to logging.INFO, and for
‘warning’ which will be set to true logging.WARN level. The purpose behind this
design is to categorize the message layout into several different formats.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="omnizart.utils.json_serializable">
<code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">json_serializable</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key_path</span><span class="o">=</span><span class="default_value">'./'</span></em>, <em class="sig-param"><span class="n">value_path</span><span class="o">=</span><span class="default_value">'./'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.json_serializable" title="Permalink to this definition">¶</a></dt>
<dd><p>Class-level decorator for making a class json-serializable object.</p>
<p>This decorator makes a class serializable as a json object. All attributes
will be outputed as a key-value pair recursively if there are also attributes
that is type of json-serializable class.
Inject two functions to the decorated class: from_json, to_json.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>key_path: Path</strong></dt><dd><p>Access sub-object according to the path. E.g. Assume you have a
dictionary: d = {“a”: {“b”: {“c”: “d”}}}, and the path: p = “a/b”,
then the sub-object after being propagated would be {“c”: “d”}.</p>
</dd>
<dt><strong>value_path: Path</strong></dt><dd><p>The relative path to the key_path. This parameter makes you able
to access the value that is not at the same level as the key.
E.g. assume you have a sub-object after the propagation of key_path:
d = {“a”: {“b”: {“c”: “d”}}}, and the value_path: vp = “a/b/c”,
the corresponding value of the key should be “d”.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">tests.test_utils.test_normal_serializable</span></code></dt><dd><p>Unit test of this decorator.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>The attributes should be defined inside ‘__init__’, or those defined as
class attributes will not be serialized as thery are invisible for
__dict__ attribute.</p>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@json_serializable</span><span class="p">()</span>
<span class="go">    class A:</span>
<span class="go">        def __init__(self):</span>
<span class="go">            self.a = 1</span>
<span class="go">            self.b = &quot;Hello&quot;</span>
<span class="go">            self.c = [10, 20, 30]</span>

<span class="go">    @json_serializable()</span>
<span class="go">    class B:</span>
<span class="go">        def __init__(self):</span>
<span class="go">            self.a_instance = A()</span>
<span class="go">            self.d = &quot;World&quot;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">inst</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inst</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="go">{</span>
<span class="go">    &quot;d&quot;: &quot;World&quot;,</span>
<span class="go">    &quot;a_instance&quot;: {</span>
<span class="go">        &quot;a&quot;: 1,</span>
<span class="go">        &quot;b&quot;: &quot;Hello&quot;,</span>
<span class="go">        &quot;c&quot;: [10, 20, 30]</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="omnizart.utils.parallel_generator">
<code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">parallel_generator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">input_list</span></em>, <em class="sig-param"><span class="n">max_workers</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">use_thread</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">chunk_size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">600</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.parallel_generator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="omnizart.utils.resolve_dataset_type">
<code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">resolve_dataset_type</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dataset_path</span></em>, <em class="sig-param"><span class="n">keywords</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.resolve_dataset_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="omnizart.utils.snake_to_camel">
<code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">snake_to_camel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">string</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.snake_to_camel" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a snake case to camel case</p>
</dd></dl>

<dl class="py function">
<dt id="omnizart.utils.synth_midi">
<code class="sig-prename descclassname">omnizart.utils.</code><code class="sig-name descname">synth_midi</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">midi_path</span></em>, <em class="sig-param"><span class="n">output_path</span></em>, <em class="sig-param"><span class="n">sampling_rate</span><span class="o">=</span><span class="default_value">44100</span></em>, <em class="sig-param"><span class="n">sf2_path</span><span class="o">=</span><span class="default_value">'/home/runner/work/omnizart/omnizart/omnizart/resource/soundfonts.sf2'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#omnizart.utils.synth_midi" title="Permalink to this definition">¶</a></dt>
<dd><p>Synthesize MIDI into wav audio.</p>
</dd></dl>

</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="constants.html"
       title="previous chapter">← Constants</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2020, MCTLab.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.3.1 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>